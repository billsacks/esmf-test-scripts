#!/bin/bash

cd /project/esmf/backup/github_src_esmf

# remove old copy of repo.
rm -rf esmf
# get new copy 
# These commands will get you the entire repo:
git clone https://github.com/esmf-org/esmf.git
cd esmf
for i in `git branch -a | grep remote | grep -v HEAD | grep -v master`; do git branch --track ${i#remotes/origin/} $i; done
git fetch --all
git pull --all

cd ..
fname=esmf-github.tar
#Remove old tarball
rm *$fname*
#Roll new tarball
datestamp=`date +%Y%m%d`
savename="${datestamp}.${fname}"
tar -cf $savename esmf
gzip $savename

#On Mondays archive the backup
day=`date +%a`
if [ $day = "Mon" ] 
then
	mv $savename.gz /project/esmf/archive/github_src_esmf
fi
